pipeline {
  agent none

  stages {
    stage('BUILD') {
      parallel {
        stage ('BUILD-productcatalogue') {
          agent { kubernetes { yamlFile 'kind/jenkins/jenkins-pod-template.yaml' } }
          steps {
            container(name: 'kaniko') {
                sh '''
  /kaniko/executor --dockerfile=apps/productcatalogue/Dockerfile-build --context=apps/productcatalogue/ --destination=ghcr.io/dum307/productcatalogue:v2.1 --ignore-path=/product_uuid
                '''
            }
          }
        }
        stage ('BUILD-shopfront') {
          agent { kubernetes { yamlFile 'kind/jenkins/jenkins-pod-template.yaml' } }
          steps {
            container(name: 'kaniko') {
                sh '''
  /kaniko/executor --dockerfile=apps/shopfront/Dockerfile-build --context=apps/shopfront/ --destination=ghcr.io/dum307/shopfront:v2.1 --ignore-path=/product_uuid
                '''
            }
          }
        }
      }
    }
  }
}